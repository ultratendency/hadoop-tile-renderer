<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Hadoop-tile-renderer by ultratendency</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Hadoop-tile-renderer</h1>
        <h2></h2>
        <a href="https://github.com/ultratendency/hadoop-tile-renderer" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h3>
<a id="welcome-to-hadoop-tile-renderer" class="anchor" href="#welcome-to-hadoop-tile-renderer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Welcome to Hadoop Tile Renderer.</h3>

<p>This project was tested on Microsoft Azure HDInsight.</p>

<h3><a id="cluster-setup" class="anchor" href="#cluster-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cluster setup - we do need some RAM.</h3>

<p>In <i>mapred-site.xml</i>:

<pre><code>mapreduce.map.memory.mb: 4096
mapreduce.reduce.memory.mb: 8192
</code></pre>

Each Container will run JVMs for the Map and Reduce tasks. The JVM heap size should be set to lower than the Map and Reduce memory defined above, so that they are within the bounds of the Container memory allocated by YARN.
</p>
<p>In <i>mapred-site.xml</i>:

<pre><code>mapreduce.map.java.opts: -Xmx3072m
mapreduce.reduce.java.opts: -Xmx6144m</code></pre>
</p>

<h4><a id="cluster-changes" class="anchor" href="#cluster-changes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Only in case of changes to the cluster.</h4>

<p>replace conf in <i>hbaseapp\conf</i> with <i>C:\apps\dist\hbase-0.98.0.2.1.6.0-2103-hadoop2\conf\hbase-site.xml</i> and rebuild</p>

<h4><a id="copy-to-cluster" class="anchor" href="#copy-to-cluster" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copy to cluster.</h4>

<p>
Download the <b>measurement.csv</b> from <a href="https://api.safecast.org/system/measurements.csv">Safecast</a>.
</p>

<ul>
	<li>hbaseapp-1.0-SNAPSHOT.jar</li>
	<li>TileViewer.html (starts zoom level 9 Center Tokyo)</li>
	<li>measurements.csv</li>
	<li>sievert_points_thermal_z9.sld</li>
	<li>sievert_points_thermal_z10.sld</li>
	<li>sievert_points_thermal_z11.sld</li>
</ul>

<p>
<pre><code>$ hadoop fs -mkdir /Output hadoop fs -mkdir /Input
$ hadoop fs -put D:\Users\safecast.headnode0\Desktop\measurements.csv /Input
</code></pre>
</p>

<h3><a id="renderer" class="anchor" href="#renderer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Renderer.</h3>

<p>
<pre><code>$ hadoop fs -mkdir /Renderer
$ hadoop fs -put D:\Users\safecast.headnode0\Desktop\sievert_points_thermal_z9.sld /Renderer
$ hadoop fs -put D:\Users\safecast.headnode0\Desktop\sievert_points_thermal_z10.sld /Renderer
$ hadoop fs -put D:\Users\safecast.headnode0\Desktop\sievert_points_thermal_z11.sld /Renderer
</code></pre>
</p>

<h3><a id="hbase" class="anchor" href="#hbase" aria-hidden="true"><span class="octicon octicon-link"></span></a>HBase.</h3>

<p>
hbase shell hbase ( main ) :001:0 > create 'safecast23','cf'
<b>Import-Job</b>
<pre><code>$ hadoop jar D:\Users\safecast.headnode0\Desktop\hbaseapp-1.0-SNAPSHOT.jar safecast.mapreduce.ImportFromSafecastCSV 
	-t safecast23 -f cf -i /Input/measurements.csv</code></pre>
<b>PointTileRenderer-Job</b>
<pre><code>$ hadoop jar D:\Users\safecast.headnode0\Desktop\hbaseapp-1.0-SNAPSHOT.jar safecast.mapreduce.PointTileMapReduce 
	-t safecast23 -f cf -c value -o /Output/ptiles9 -zmin 9 -zmax 9 -r 16</code></pre>
</p>
<ul>
	<li>zmin = zmax !!!!!! ATTENTION: only zoom levels 9-12 supported; set zmin = zmax</li>
	<li>-t Table</li>
	<li>-f ColumnFam</li>
	<li>-c column</li>
	<li>-o OutputDir</li>
	<li>-r Reducer count</li>
</ul>

<h4><a id="set-mappers-region-split" class="anchor" href="#set-mappers-region-split" aria-hidden="true"><span class="octicon octicon-link"></span></a>To set #mappers, region split.</h4>

<p>
<b>Copy to local desktop</b>
<pre><code>$ hadoop fs -copyToLocal /Output/ptiles9 D:\Users\safecast.headnode0\Desktop\</code></pre>
</p>

<h3><a id="tuning" class="anchor" href="#tuning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tuning.</h3>

<h4><a id="split-for-more-mappers" class="anchor" href="#split-for-more-mappers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Split for more mappers.</h4>

<p>
<pre><code>$ hbase shell hbase ( main ) :001:0 > split ‘safecast23’</code></pre>
</p>

<h4><a id="problems" class="anchor" href="#problems" aria-hidden="true"><span class="octicon octicon-link"></span></a>Problems.</h4>

<p>
Check if anything works at all with
<pre><code>$ hadoop jar D:\Users\safecast.headnode0\Desktop\hbaseapp-1.0-SNAPSHOT.jar com.microsoft.examples.CreateTable</code></pre></p>

        </section>

        <aside id="sidebar">
          <a href="https://github.com/ultratendency/hadoop-tile-renderer/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/ultratendency/hadoop-tile-renderer/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/ultratendency/hadoop-tile-renderer"></a> is maintained by <a href="https://github.com/ultratendency">ultratendency</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>